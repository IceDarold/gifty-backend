# Auth API Reference üîê

–°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Gifty –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –±–∞–∑–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ **OAuth 2.0 —Å PKCE**. –ú—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Google, Yandex –∏ VK. –°–µ—Å—Å–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Redis –∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ HttpOnly Secure –∫—É–∫–∏.

---

## üöÄ –ü—Ä–æ—Ç–æ–∫–æ–ª –≤—Ö–æ–¥–∞ (Flow)

–î–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å –≤—Ö–æ–¥–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
1. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ `/auth/{provider}/start`.
2. –ë–µ–∫–µ–Ω–¥ –≤—ã–ø–æ–ª–Ω–∏—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.
3. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≤–µ—Ä–Ω–µ—Ç —é–∑–µ—Ä–∞ –Ω–∞ –Ω–∞—à Callback.
4. –ë–µ–∫–µ–Ω–¥ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å–µ—Å—Å–∏–æ–Ω–Ω—É—é –∫—É–∫—É `gifty_session` –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥.

---

## üîë –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (`/{provider}/start`)
–ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤—Ö–æ–¥–∞.

*   **URL**: `/api/v1/auth/{provider}/start`
*   **–ú–µ—Ç–æ–¥**: `GET`
*   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
    - `provider`: `google`, `yandex` –∏–ª–∏ `vk`.
    - `return_to` (query, optional): URL –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ, –∫—É–¥–∞ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `/`).
*   **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 302 Redirect.

### 2. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ–±–µ (`/me`)
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

*   **URL**: `/api/v1/auth/me`
*   **–ú–µ—Ç–æ–¥**: `GET`
*   **Response**: `UserDTO`
    ```json
    {
      "id": "uuid",
      "name": "–ò–º—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
      "email": "user@example.com",
      "avatar_url": "https://...",
      "is_active": true
    }
    ```
*   **–û—à–∏–±–∫–∏**:
    - `401 Unauthorized`: –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.

### 3. –í—ã—Ö–æ–¥ (`/logout`)
–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏.

*   **URL**: `/api/v1/auth/logout`
*   **–ú–µ—Ç–æ–¥**: `POST`
*   **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –£–¥–∞–ª–µ–Ω–∏–µ –∫—É–∫–∏ –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Redis.

---

## üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

*   **Cookies**: –ö—É–∫–∞ `gifty_session` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å —Ñ–ª–∞–≥–∞–º–∏ `HttpOnly`, `Secure`, `SameSite=Lax`.
*   **PKCE**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –∫–æ–¥–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
*   **State**: –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫ —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è.
