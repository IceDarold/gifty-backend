# Internal API Reference üîê

Internal API –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã Gifty: –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é (Dashboard), –≤–æ—Ä–∫–µ—Ä–∞–º–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ —Å–∏—Å—Ç–µ–º–æ–π —Å–∫–æ—Ä–∏–Ω–≥–∞ (Intelligence). 

–≠—Ç–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π –∏ **–Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã** –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ –ø—É–±–ª–∏—á–Ω–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Internal API —Ç—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-Internal-Token`.

| –ó–∞–≥–æ–ª–æ–≤–æ–∫ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| `X-Internal-Token` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω, –∑–∞–¥–∞–Ω–Ω—ã–π –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö (`INTERNAL_API_TOKEN`). |

---

## üï∑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü–∞—Ä—Å–∏–Ω–≥–æ–º (Sources)

### 1. –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (`/sources`)
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∞–π—Ç—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö.

*   **URL**: `/internal/sources`
*   **–ú–µ—Ç–æ–¥**: `GET`
*   **Response**: `List[ParsingSourceSchema]`

### 2. –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (`/sources/{source_id}`)
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø—É—Å–∫–æ–≤, —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ñ–∏–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞.

*   **URL**: `/internal/sources/{source_id}`
*   **–ú–µ—Ç–æ–¥**: `GET`
*   **Response**: `ParsingSourceSchema` (–≤–∫–ª—é—á–∞—è –º–∞—Å—Å–∏–≤ `history` –∏ `total_items`).

### 3. –ë—ç–∫–ª–æ–≥ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è (`/sources/backlog`)
–°–ø–∏—Å–æ–∫ –Ω–æ–≤—ã—Ö —Å–∞–π—Ç–æ–≤ –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—à–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∞ –ø–∞—Ä—Å–∏—Ç—å.

*   **URL**: `/internal/sources/backlog`
*   **–ú–µ—Ç–æ–¥**: `GET`
*   **Response**: `List[ParsingSourceSchema]` (–æ–±—ä–µ–∫—Ç—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `discovered`).

### 4. –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–≥–æ (`/sources/backlog/activate`)
–ú–∞—Å—Å–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏–∑ –±—ç–∫–ª–æ–≥–∞ –≤ –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º.

*   **URL**: `/internal/sources/backlog/activate`
*   **–ú–µ—Ç–æ–¥**: `POST`
*   **Body**: `{ "source_ids": [1, 2, 3] }`

### 5. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (`/{id}/force-run`)
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –Ω–∞ –ø–∞—Ä—Å–∏–Ω–≥ –≤ RabbitMQ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –∏–≥–Ω–æ—Ä–∏—Ä—É—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.

*   **URL**: `/internal/sources/{source_id}/force-run`
*   **–ú–µ—Ç–æ–¥**: `POST`
*   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
    - `strategy` (optional): –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (`discovery` –∏–ª–∏ `deep`).

### 6. –í–∫–ª—é—á–µ–Ω–∏–µ/–í—ã–∫–ª—é—á–µ–Ω–∏–µ (`/{id}/toggle`)
–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∏–ª–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.

*   **URL**: `/internal/sources/{source_id}/toggle`
*   **–ú–µ—Ç–æ–¥**: `POST`
*   **Body**: `{ "is_active": bool }`

---

## üì¶ –°–±–æ—Ä –∏ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### 1. –ü—Ä–∏–µ–º –¥–∞–Ω–Ω—ã—Ö (`/ingest-batch`)
–û—Å–Ω–æ–≤–Ω–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π Scrapy-–≤–æ—Ä–∫–µ—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –æ—Å–Ω–æ–≤–Ω—É—é –ë–î.

*   **URL**: `/internal/ingest-batch`
*   **–ú–µ—Ç–æ–¥**: `POST`
*   **Body**: `IngestBatchRequest` (—Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π).

### 2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤ (`/workers`)
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç Scrapy-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –∏—Ö —Ç–µ–∫—É—â—É—é –∑–∞–≥—Ä—É–∑–∫—É.

*   **URL**: `/internal/workers`
*   **–ú–µ—Ç–æ–¥**: `GET`

---

## üß† –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç –∏ –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è

### 1. –ó–∞–¥–∞—á–∏ –Ω–∞ —Å–∫–æ—Ä–∏–Ω–≥–∞ (`/scoring/tasks`)
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω–∏–º–∏ LLM-–≤–æ—Ä–∫–µ—Ä–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ Kaggle/Colab) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –ø—Ä–æ—à–ª–∏ –æ—Ü–µ–Ω–∫—É –ø–æ 10 –æ—Å—è–º GUTG.

*   **URL**: `/internal/scoring/tasks`
*   **–ú–µ—Ç–æ–¥**: `GET`
*   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `limit` (default: 50).

### 2. –ó–∞–¥–∞—á–∏ –Ω–∞ –º–∞–ø–ø–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (`/categories/tasks`)
–°–ø–∏—Å–æ–∫ ¬´—Å—ã—Ä—ã—Ö¬ª –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –æ—Ç –ø–∞—Ä—Å–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –¥–µ—Ä–µ–≤–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–π Gifty —Å –ø–æ–º–æ—â—å—é AI.

*   **URL**: `/internal/categories/tasks`
*   **–ú–µ—Ç–æ–¥**: `GET`

---

## üõ° –î–æ—Å—Ç—É–ø –∏ Telegram

### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º–∏ (`/telegram/subscribers`)
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Telegram-–±–æ—Ç–∞ –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (—Ä–æ–ª–∏ `admin`, `superadmin`).

### 2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è WebApp (`/webapp/auth`)
–ü—Ä–æ–≤–µ—Ä–∫–∞ `initData` –æ—Ç Telegram Mini App –¥–ª—è –≤—Ö–æ–¥–∞ –≤ Dashboard.

*   **URL**: `/internal/webapp/auth`
*   **–ú–µ—Ç–æ–¥**: `POST`
*   **Body**: `{ "init_data": "..." }`
