# Analytics API Reference üìà

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ Gifty. API –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ —Ä–æ–ª–∏ –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–∫—Å–∏ –º–µ–∂–¥—É –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –¥–∞—à–±–æ—Ä–¥–æ–º –∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (PostHog, Prometheus, PostgreSQL).

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Analytics API —Ç—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-Analytics-Token`.

| –ó–∞–≥–æ–ª–æ–≤–æ–∫ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| `X-Analytics-Token` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω, –∑–∞–¥–∞–Ω–Ω—ã–π –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö (`ANALYTICS_API_TOKEN`). |

---

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. –û—Å–Ω–æ–≤–Ω—ã–µ KPI (`/stats`)
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞ –∏ 7 –¥–Ω–µ–π.

*   **URL**: `/analytics/stats`
*   **–ú–µ—Ç–æ–¥**: `GET`
*   **Response**:
    ```json
    {
      "dau": 150,
      "quiz_completion_rate": 65.5,
      "gift_ctr": 12.3,
      "total_sessions": 450,
      "last_updated": "2024-02-10T12:00:00Z"
    }
    ```

**–ü–æ–ª—è –æ—Ç–≤–µ—Ç–∞:**
- `dau`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ 24 —á–∞—Å–∞.
- `quiz_completion_rate`: % –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∫–≤–∏–∑–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π.
- `gift_ctr`: % –∫–ª–∏–∫–æ–≤ –ø–æ —Ç–æ–≤–∞—Ä–∞–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–∫–∞–∑–æ–≤ –≤—ã–¥–∞—á–∏.
- `total_sessions`: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—á–∞—Ç—ã—Ö –∫–≤–∏–∑–æ–≤ –∑–∞ 7 –¥–Ω–µ–π.

---

### 2. –¢—Ä–µ–Ω–¥—ã –∏ –ì—Ä–∞—Ñ–∏–∫–∏ (`/trends`)
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ª–∏–Ω–µ–π–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤.

*   **URL**: `/analytics/trends`
*   **–ú–µ—Ç–æ–¥**: `GET`
*   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
    - `days` (query, optional): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (default: 7, max: 90).
*   **Response**:
    ```json
    {
      "dates": ["2024-02-03", "2024-02-04", ...],
      "dau_trend": [120, 145, ...],
      "quiz_starts": [50, 62, ...],
      "last_updated": "2024-02-10T12:00:00Z"
    }
    ```

---

### 3. –í–æ—Ä–æ–Ω–∫–∞ –ö–æ–Ω–≤–µ—Ä—Å–∏–∏ (`/funnel`)
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π.

*   **URL**: `/analytics/funnel`
*   **–ú–µ—Ç–æ–¥**: `GET`
*   **Response**:
    ```json
    {
      "steps": [
        { "name": "quiz_started", "count": 1000, "conversion_rate": 100.0 },
        { "name": "quiz_completed", "count": 650, "conversion_rate": 65.0 },
        { "name": "results_shown", "count": 600, "conversion_rate": 92.3 },
        { "name": "gift_clicked", "count": 80, "conversion_rate": 13.3 }
      ],
      "last_updated": "2024-02-10T12:00:00Z"
    }
    ```

---

### 4. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (`/technical`)
–ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã –∏–∑ Prometheus –∏ Loki.

*   **URL**: `/analytics/technical`
*   **–ú–µ—Ç–æ–¥**: `GET`
*   **Response**:
    ```json
    {
      "api_health": "healthy",
      "requests_per_minute": 120.5,
      "error_rate_5xx": 0.001,
      "active_workers": 4,
      "last_errors": ["Error in search vector...", "Timeout connecting to LLM..."],
      "last_updated": "2024-02-10T12:00:00Z"
    }
    ```

---

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ü–∞—Ä—Å–∏–Ω–≥–∞ (`/scraping`)
–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞–±–æ—Ç–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö.

*   **URL**: `/analytics/scraping`
*   **–ú–µ—Ç–æ–¥**: `GET`
*   **Response**:
    ```json
    {
      "active_sources": 12,
      "unmapped_categories": 5,
      "total_scraped_items": 45000,
      "ingestion_errors": 2,
      "spiders": {
        "ozon": { "items_scraped": 15000 },
        "wildberries": { "items_scraped": 30000 }
      }
    }
    ```

---

## –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Redis:
- –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (PostHog): 5-10 –º–∏–Ω—É—Ç.
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (Prometheus): 1 –º–∏–Ω—É—Ç–∞.
- –û—à–∏–±–∫–∏ (Loki): 1 –º–∏–Ω—É—Ç–∞.
