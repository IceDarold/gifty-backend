# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤ üï∑Ô∏è

–í —Å–∏—Å—Ç–µ–º–µ Gifty —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–º–æ—â—å—é **Scrapy**. –î–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –±–µ—Ä–µ—Ç –Ω–∞ —Å–µ–±—è –≤—Å—é —Ä—É—Ç–∏–Ω—É –ø–æ —Ä–∞–±–æ—Ç–µ —Å –æ—á–µ—Ä–µ–¥—è–º–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å API.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```bash
pip install -r requirements.txt
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–∞—É–∫–∞
–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `services/gifty_scraper/spiders/`. 
–ù–∞–∑–æ–≤–∏—Ç–µ –µ–≥–æ –ø–æ –∏–º–µ–Ω–∏ —Å–∞–π—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä `ozon.py` –∏–ª–∏ `my_shop.py`.

### 3. –ù–∞–ø–∏—Å–∞–Ω–∏–µ –∫–æ–¥–∞
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `GiftyBaseSpider` –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —à–∞–±–ª–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞.

```python
from gifty_scraper.base_spider import GiftyBaseSpider

class MyShopSpider(GiftyBaseSpider):
    name = "my_shop"        # –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
    allowed_domains = ["myshop.ru"]
    site_key = "myshop"    # –ö–ª—é—á, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–π–¥–µ—Ç —ç—Ç–æ—Ç –ø–∞—É–∫

    def parse_catalog(self, response):
        # –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤
        items = response.css('.product-card')
        
        for item in items:
            yield self.create_product(
                title=item.css('.title::text').get().strip(),
                product_url=response.urljoin(item.css('a::attr(href)').get()),
                price=item.css('.price-value::text').re_first(r'(\d+)'),
                image_url=item.css('img::attr(src)').get(),
                merchant="My Shop",
                raw_data={"source": "scrapy_v1"}
            )

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (–µ—Å–ª–∏ strategy="deep")
        if self.strategy == "deep":
            next_page = response.css('a.next-btn::attr(href)').get()
            if next_page:
                yield response.follow(next_page, self.parse_catalog)
```

---

## üõ†Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏ –±–µ–∑ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (Docker/API) –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
python3 scripts/test_spider.py my_shop "https://myshop.ru/catalog" --limit 10
```

*   **`--limit`**: –û–≥—Ä–∞–Ω–∏—á–∏—Ç —Å–±–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–≤—ã–µ 10 —Ç–æ–≤–∞—Ä–æ–≤).
*   **`--output`**: –ò–º—è —Ñ–∞–π–ª–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `test_results.json`).

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π JSON —Ñ–∞–π–ª ‚Äî –µ—Å–ª–∏ —Ç–∞–º –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ, –∑–Ω–∞—á–∏—Ç —Å–µ–ª–µ–∫—Ç–æ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤–µ—Ä–Ω–æ.

---

## ‚õìÔ∏è –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ

–ß—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—É–∫ –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ:

### 1. –î–æ–±–∞–≤—å—Ç–µ –≤ Worker
–û—Ç–∫—Ä–æ–π—Ç–µ `services/run_worker.py` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à –∫–ª–∞—Å—Å –≤ —Å–ª–æ–≤–∞—Ä—å `SPIDERS`:

```python
from gifty_scraper.spiders.my_shop import MyShopSpider

SPIDERS = {
    "mrgeek": MrGeekSpider,
    "myshop": MyShopSpider,  # <-- –î–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞
}
```

### 2. –î–æ–±–∞–≤—å—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –≤ –ë–î
–ß—Ç–æ–±—ã –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–∞—á–∞–ª –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–¥–∞—á–∏, –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `parsing_sources`:

```sql
INSERT INTO parsing_sources (url, type, site_key, priority, refresh_interval_hours, is_active)
VALUES ('https://myshop.ru/catalog', 'list', 'myshop', 50, 24, true);
```

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1.  **Throttling**: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—Ç–æ–∏—Ç –∑–∞–¥–µ—Ä–∂–∫–∞ 1—Å –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏. –ï—Å–ª–∏ —Å–∞–π—Ç –±–ª–æ–∫–∏—Ä—É–µ—Ç ‚Äî —É–≤–µ–ª–∏—á—å—Ç–µ `DOWNLOAD_DELAY` –≤ `settings.py`.
2.  **CSS vs XPath**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CSS —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –≤–µ–∑–¥–µ, –≥–¥–µ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ ‚Äî –æ–Ω–∏ –ø—Ä–æ—â–µ —á–∏—Ç–∞—é—Ç—Å—è.
3.  **Images**: –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ `image_url` ‚Äî —ç—Ç–æ –ø–æ–ª–Ω–∞—è —Å—Å—ã–ª–∫–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `response.urljoin`).
4.  **Batching**: –ù–∞—à Pipeline –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ –ø–∞—á–∫–∏ –ø–æ 50 —à—Ç—É–∫ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ API –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.
