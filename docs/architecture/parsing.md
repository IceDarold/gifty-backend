# –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ü–∞—Ä—Å–∏–Ω–≥–∞ v2.1

–í —ç—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ –¥–µ—Ç–∞–ª—å–Ω–æ –æ–ø–∏—Å–∞–Ω–∞ —Ü–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (Scraping System) –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ Gifty. –ú—ã –ø–µ—Ä–µ—Ö–æ–¥–∏–º –æ—Ç –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–µ—Ä–æ–≤ –∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

---

## 1. –û–±—â–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (The Big Picture)

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ —Ç—Ä–∏ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Å–ª–æ—è:

1.  **Orchestration (–ú–æ–∑–≥)**: –ü–ª–∞–Ω–∏—Ä—É–µ—Ç, *—á—Ç–æ* –∏ *–∫–æ–≥–¥–∞* –ø–∞—Ä—Å–∏—Ç—å, –∏—Å—Ö–æ–¥—è –∏–∑ —Ç–∏–ø–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤.
2.  **Execution (–ú—ã—à—Ü—ã)**: –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã –Ω–∞ –±–∞–∑–µ Scrapy.
3.  **Storage & Processing (–ü–∞–º—è—Ç—å)**: –ü—Ä–∏–µ–º–∫–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

```mermaid
sequenceDiagram
    participant S as Scheduler
    participant Q as RabbitMQ
    participant W as Scrapy Worker
    participant T as Target Site
    participant A as Ingestion API
    participant DB as Postgres

    S->>S: Scan Due Sources
    S->>Q: Hub/List Task
    Q->>W: Pick Up
    W->>T: Fetch Content
    T-->>W: HTML
    W->>W: Extract Links/Items
    W->>A: Batch Ingest
    A->>A: Validate/Clean
    A->>DB: Upsert Products
    A->>DB: Update Source Stats
```

---

## 2. –°–ª–æ–π –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ (Scheduler)

### 2.1 –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (Source Types)
–°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–ª–∏—á–∞–µ—Ç —Ç–∏–ø—ã —Å—Ç—Ä–∞–Ω–∏—Ü, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ —Ç—Ä–µ–±—É—é—Ç —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–∏. –í –ë–î –≤–≤–æ–¥–∏—Ç—Å—è –ø–æ–ª–µ `type`:

1.  **Hub / Category List (`hub`)**:
    *   *–ü—Ä–∏–º–µ—Ä*: `groupprice.ru/catalog/gifts` (–ø–ª–∏—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π "–ú–∞–º–µ", "–ü–∞–ø–µ").
    *   *–ó–∞–¥–∞—á–∞*: **Discovery**. –ù–∞–π—Ç–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–æ–≤—ã–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö –≤ –ë–î. –ù–µ –ø–∞—Ä—Å–∏—Ç —Ç–æ–≤–∞—Ä—ã.
    *   *–ß–∞—Å—Ç–æ—Ç–∞*: –†–µ–¥–∫–æ (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é/–º–µ—Å—è—Ü). –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∞–π—Ç–æ–≤ –º–µ–Ω—è–µ—Ç—Å—è –Ω–µ—á–∞—Å—Ç–æ.

2.  **Product List (`list`)** ‚Äî **–û—Å–Ω–æ–≤–Ω–æ–π —Ç–∏–ø**:
    *   *–ü—Ä–∏–º–µ—Ä*: `mrgeek.ru/category/vse-tovary/`.
    *   *–ó–∞–¥–∞—á–∞*: **Extraction**. –ü—Ä–æ–π—Ç–∏—Å—å –ø–æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏, —Å–æ–±—Ä–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (–¶–µ–Ω–∞, –ù–∞–∑–≤–∞–Ω–∏–µ, –ö–∞—Ä—Ç–∏–Ω–∫–∞) –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏.
    *   *–ß–∞—Å—Ç–æ—Ç–∞*: –ï–∂–µ–¥–Ω–µ–≤–Ω–æ (—Ä–∞–∑ –≤ 12-24—á).
    *   *–°—Ç—Ä–∞—Ç–µ–≥–∏—è*: –ú—ã —Ö—Ä–∞–Ω–∏–º –≤ –ë–î –∏–º–µ–Ω–Ω–æ "–ª–∏—Å—Ç–æ–≤—ã–µ" –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–∫–æ–Ω–µ—á–Ω—ã–µ). –≠—Ç–æ –Ω–∞–¥–µ–∂–Ω–µ–µ, —á–µ–º –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –•–∞–±.

3.  **Single Product (`product`)**:
    *   *–ü—Ä–∏–º–µ—Ä*: `ozon.ru/product/iphone-15`.
    *   *–ó–∞–¥–∞—á–∞*: **Deep Dive**. –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –æ—Ç–∑—ã–≤—ã.
    *   *–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ*: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—á–µ—á–Ω–æ, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–ª–∏ –Ω—É–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ü–µ–Ω—É VIP-—Ç–æ–≤–∞—Ä–∞ –∫–∞–∂–¥—ã–π —á–∞—Å.

4.  **Sitemap XML (`sitemap`)**:
    *   *–ü—Ä–∏–º–µ—Ä*: `site.com/sitemap.xml`.
    *   *–ó–∞–¥–∞—á–∞*: **Bulk Discovery**. "–ó–æ–ª–æ—Ç–æ–π –ì—Ä–∞–∞–ª—å" ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å 100% —Å—Å—ã–ª–æ–∫ –º–∞–≥–∞–∑–∏–Ω–∞ –±–µ–∑ –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML.
    *   *–°–ª–æ–∂–Ω–æ—Å—Ç—å*: –ù–∏–∑–∫–∞—è, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è.

### 2.2 –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (Strategies)
–ü–æ–ª–µ `strategy` —É—Ç–æ—á–Ω—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–∞ –≤ —Ä–∞–º–∫–∞—Ö –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

*   **`deep` (–û—Å–Ω–æ–≤–Ω–∞—è)**: –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è. –ò–¥–µ–º –ø–æ –≤—Å–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º. –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã.
*   **`discovery` (–ü–æ–∏—Å–∫)**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è `type: hub`. –ò—â–µ–º –Ω–æ–≤—ã–µ —Å—Å—ã–ª–∫–∏, —Ç–æ–≤–∞—Ä—ã –Ω–µ —Å–æ–±–∏—Ä–∞–µ–º.

### 2.3 –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö `ParsingSource`
–¢–∞–±–ª–∏—Ü–∞-—Ä–µ–µ—Å—Ç—Ä –≤ PostgreSQL:

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `url` | String | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞. |
| `type` | Enum | `hub`, `list`, `product`, `sitemap`. |
| `site_key` | String | `mrgeek`, `ozon`. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–ª–∞—Å—Å Spider'–∞. |
| `priority` | Int | 1-100. –í–ª–∏—è–µ—Ç –Ω–∞ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å –≤ RabbitMQ. |
| `refresh_interval` | Int | –ë–∞–∑–æ–≤–∞—è —á–∞—Å—Ç–æ—Ç–∞ (—á–∞—Å—ã). |
| `next_sync_at` | DateTime | –í—Ä–µ–º—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–∏–Ω–¥–µ–∫—Å). |
| `config` | JSON | –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (Cookie, Geo, Proxy settings). |

### 2.4 –õ–æ–≥–∏–∫–∞ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ (The Loop)
–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ Cron (—Ä–∞–∑ –≤ 5 –º–∏–Ω—É—Ç):

1.  **Select**: –í—ã–±–∏—Ä–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏, –≥–¥–µ `next_sync_at <= NOW()`.
2.  **Lock**: –û–±–Ω–æ–≤–ª—è–µ—Ç `next_sync_at` –Ω–∞ –±—É–¥—É—â–µ–µ ("–±—Ä–æ–Ω–∏—Ä—É–µ—Ç").
3.  **Publish**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –≤ RabbitMQ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º `page_type`.
    *   –ï—Å–ª–∏ –≤–æ—Ä–∫–µ—Ä —É–≤–∏–¥–∏—Ç `type='hub'`, –æ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç –ª–æ–≥–∏–∫—É –ø–æ–∏—Å–∫–∞ —Å—Å—ã–ª–æ–∫.
    *   –ï—Å–ª–∏ `type='list'`, –∑–∞–ø—É—Å—Ç–∏—Ç –ª–æ–≥–∏–∫—É —Å–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–æ–≤.

### 2.5 Smart Scheduling (–£–º–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
–í–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é –ª–æ–≥–∏–∫—É, –æ—Å–Ω–æ–≤–∞–Ω–Ω—É—é –Ω–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –æ—Ç Ingestion API:

1.  **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (Stale Decay)**:
    *   –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫ –Ω–µ –≤—ã—è–≤–∏–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π (`items_updated == 0`), –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è (Step: x1.5).
    *   –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –≤—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–º–Ω–æ–≥–æ –Ω–æ–≤–∏–Ω–æ–∫ –∏–ª–∏ —Å–º–µ–Ω —Ü–µ–Ω), –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–æ–∫—Ä–∞—â–∞–µ—Ç—Å—è –¥–æ –º–∏–Ω–∏–º—É–º–∞ –¥–ª—è —ç—Ç–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.
2.  **Exponential Backoff (–û–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)**:
    *   –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏ –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (403, 503), –≤—Ä–µ–º—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–æ–¥–≤–∏–≥–∞–µ—Ç—Å—è –ø–æ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–µ: 1—á -> 4—á -> 24—á.
3.  **–ü—Ä–∏–æ—Ä–∏—Ç–µ–∑–∞—Ü–∏—è**:
    *   –ó–∞–¥–∞—á–∏ –≤ RabbitMQ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å —Ä–∞–∑–Ω—ã–º `priority` (–∏—Å–ø–æ–ª—å–∑—É—è RabbitMQ Priority Queues). –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Å–∞–π—Ç—ã —Å –≤—ã—Å–æ–∫–∏–º `Base_Priority` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤–æ—Ä–∫–µ—Ä–∞–º–∏ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å.
4.  **–û–∫–Ω–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è**:
    *   –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–∞–π—Ç–æ–≤ —Ç–æ–ª—å–∫–æ –Ω–æ—á–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º, —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å —Ä–∏—Å–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∏ –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–∞–π—Ç-–¥–æ–Ω–æ—Ä.

### –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
<div class="weeek-tracker" data-tag-names="Parsing"></div>

---

## 3. –°–ª–æ–π –ò—Å–ø–æ–ª–Ω–µ–Ω–∏—è (Scraping Workers)

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞ –±–∞–∑–µ **Scrapy**. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏ –∏–∑ –æ—á–µ—Ä–µ–¥–∏.

### Workflow –í–æ—Ä–∫–µ—Ä–∞
1.  **Consume**: –ü–æ–ª—É—á–∞–µ—Ç JSON –∑–∞–¥–∞—á—É.
    ```json
    { "url": "...", "type": "list", "site_key": "mrgeek" }
    ```
2.  **Select Spider**: –ó–∞–ø—É—Å–∫–∞–µ—Ç –Ω—É–∂–Ω—ã–π Java/Python –∫–ª–∞—Å—Å.
3.  **Crawl**:
    *   **Proxy Rotation**: Middleware –º–µ–Ω—è–µ—Ç IP –ø—Ä–∏ –±–∞–Ω–µ (403/Capt—Åha).
    *   **User-Agent**: –†–æ—Ç–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤.
    *   **Throttling**: –ê–≤—Ç–æ-—Å–Ω–∏–∂–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏, –µ—Å–ª–∏ —Å–∞–π—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç.
4.  **Output**:
    *   –ï—Å–ª–∏ `list`: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞—á–∫—É —Ç–æ–≤–∞—Ä–æ–≤ (Batch) –≤ API.
    *   –ï—Å–ª–∏ `hub`: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ URL –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö `ParsingSource`.

### –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
<div class="weeek-tracker" data-tag-names="Parsing" data-project-id="2"></div>

---

## 4. –°–ª–æ–π –î–∞–Ω–Ω—ã—Ö (Ingestion API)

–ü–∞—Ä—Å–µ—Ä—ã –Ω–µ –ø–∏—à—É—Ç –≤ –ë–î –Ω–∞–ø—Ä—è–º—É—é. API (`POST /internal/ingest`) –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–æ–ª—å —Å—Ç—Ä–∞–∂–∞:

1.  **Validation**: –û—Ç—Å–µ–∏–≤–∞–µ—Ç –±–∏—Ç—ã–µ —Ç–æ–≤–∞—Ä—ã (–Ω–µ—Ç —Ü–µ–Ω—ã/–∫–∞—Ä—Ç–∏–Ω–∫–∏).
2.  **Normalization**: –í–∞–ª—é—Ç—ã -> RUB, –æ—á–∏—Å—Ç–∫–∞ HTML —Ç–µ–≥–æ–≤.
3.  **Upsert**: –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–≤–∞—Ä –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π.
4.  **Feedback**: –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (items_found, duration), —á—Ç–æ–±—ã –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –º–æ–≥ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–æ—Ç—É.

### 4.1 AI Category Mapping (–ú–∞–ø–ø–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
–ß—Ç–æ–±—ã –ø—Ä–∏–≤–µ—Å—Ç–∏ —Ç—ã—Å—è—á–∏ –≤–Ω–µ—à–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π ("–ü—Ä–∏–∫–æ–ª—å–Ω—ã–µ –∫—Ä—É–∂–∫–∏", "–ß–∞—à–∫–∏ –¥–ª—è —á–∞—è") –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É Gifty:

1.  **Table `CategoryMap`**: –•—Ä–∞–Ω–∏—Ç —Å–≤—è–∑–∫—É `external_name` -> `internal_category_id`.
2.  **Runtime**: –ï—Å–ª–∏ Ingestion API –≤—Å—Ç—Ä–µ—á–∞–µ—Ç –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –æ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤ `CategoryMap` —Å `internal_id=NULL` –∏ –ø–æ–º–µ—á–∞–µ—Ç —Ç–æ–≤–∞—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π.
3.  **Background Job (AI Classifier)**: –†–∞–∑ –≤ —á–∞—Å –±–µ—Ä–µ—Ç –Ω–µ—Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç LLM (Gemini/GPT) –≤–º–µ—Å—Ç–µ —Å–æ —Å–ø–∏—Å–∫–æ–º –Ω–∞—à–∏—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
    *   *Prompt*: "–°–æ–ø–æ—Å—Ç–∞–≤—å —Å–ø–∏—Å–æ–∫ –ê —Å–æ —Å–ø–∏—Å–∫–æ–º –ë".
    *   –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î, –∏ —Ç–æ–≤–∞—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è.
 
### –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
<div class="weeek-tracker" data-tag-names="Ingestion,AI" data-project-id="2"></div>

---

## 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –î–µ–ø–ª–æ–π (CI/CD)

–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä—Å–µ—Ä–æ–≤ —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –∫ —Ç–µ—Å—Ç–∞–º, —Ç–∞–∫ –∫–∞–∫ —Å–∞–π—Ç—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –º–µ–Ω—è—é—Ç—Å—è.

### 5.1 –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Fixture Tests)
–ú—ã –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ –∂–∏–≤—ã—Ö —Å–∞–π—Ç–∞—Ö –≤ CI (—ç—Ç–æ –Ω–µ–Ω–∞–¥–µ–∂–Ω–æ).
1.  –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ —Ñ–∞–π–ª: `tests/fixtures/mrgeek.html`.
2.  –ü–∏—à–µ—Ç —Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ç—Ä–∞–≤–ª–∏–≤–∞–µ—Ç Spider –Ω–∞ —ç—Ç–æ—Ç —Ñ–∞–π–ª.
3.  –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∏–∑–≤–ª–µ–∫–ª–æ—Å—å —Ä–æ–≤–Ω–æ 36 —Ç–æ–≤–∞—Ä–æ–≤ –∏ –ø–æ–ª—è (–¶–µ–Ω–∞, –ù–∞–∑–≤–∞–Ω–∏–µ) –Ω–µ –ø—É—Å—Ç—ã–µ.
*   **–ü–ª—é—Å**: –¢–µ—Å—Ç—ã –ø—Ä–æ–ª–µ—Ç–∞—é—Ç –∑–∞ —Å–µ–∫—É–Ω–¥—É –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.

### 5.2 –ü—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
Scraper Service ‚Äî —ç—Ç–æ Stateless –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.
1.  –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–¥–∞ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π Docker image.
2.  –í–æ—Ä–∫–µ—Ä—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ—ç—Ç–∞–ø–Ω–æ (Rolling Update).
3.  –ó–∞–¥–∞—á–∏ –≤ RabbitMQ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è: –µ—Å–ª–∏ –≤–æ—Ä–∫–µ—Ä —É–º–µ—Ä –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏, –∑–∞–¥–∞—á–∞ –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å –¥–ª—è –¥—Ä—É–≥–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞.
---

## 6. –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø–∞—Ä—Å–µ—Ä–æ–≤

–ü–æ–¥—Ä–æ–±–Ω–∞—è –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –ø–∞—É–∫–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ:

üëâ **[–ì–∞–π–¥ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ø–∞—Ä—Å–µ—Ä–æ–≤](../guides/parsing.md)**
