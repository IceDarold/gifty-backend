{
  "id": null,
  "uid": "gifty-api-overview",
  "title": "Gifty API Overview",
  "tags": ["gifty", "api"],
  "timezone": "browser",
  "schemaVersion": 39,
  "version": 1,
  "refresh": "30s",
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "links": [
    {
      "title": "Open traces in Tempo",
      "type": "link",
      "icon": "external link",
      "url": "/grafana/explore?orgId=1&left=%7B%22datasource%22:%22Tempo%22,%22queries%22:%5B%7B%22refId%22:%22A%22,%22queryType%22:%22traceql%22,%22query%22:%22%7B%20resource.service.name%20%3D%20%5C%22gifty-api%5C%22%20%7D%22%7D%5D,%22range%22:%7B%22from%22:%22$__from%22,%22to%22:%22$__to%22%7D%7D",
      "targetBlank": true
    }
  ],
  "templating": {
    "list": [
      {
        "name": "datasource",
        "type": "datasource",
        "label": "Datasource",
        "query": "prometheus",
        "current": {
          "text": "Prometheus",
          "value": "Prometheus"
        }
      },
      {
        "name": "handler",
        "type": "query",
        "label": "Handler",
        "datasource": "$datasource",
        "definition": "label_values(http_requests_total, handler)",
        "query": {
          "query": "label_values(http_requests_total, handler)",
          "refId": "StdVar"
        },
        "includeAll": true,
        "allValue": ".*",
        "multi": true,
        "current": {
          "text": "All",
          "value": "$__all"
        }
      }
    ]
  },
  "panels": [
    {
      "type": "stat",
      "title": "RPS (all)",
      "gridPos": { "x": 0, "y": 0, "w": 6, "h": 5 },
      "datasource": "$datasource",
      "targets": [
        {
          "refId": "A",
          "expr": "sum(rate(http_requests_total[1m]))",
          "legendFormat": "rps"
        }
      ],
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "horizontal",
        "textMode": "value",
        "colorMode": "value"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "decimals": 2
        },
        "overrides": []
      }
    },
    {
      "type": "stat",
      "title": "5xx RPS",
      "gridPos": { "x": 6, "y": 0, "w": 6, "h": 5 },
      "datasource": "$datasource",
      "targets": [
        {
          "refId": "A",
          "expr": "sum(rate(http_requests_total{status=~\"5..\"}[1m]))",
          "legendFormat": "5xx"
        }
      ],
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "horizontal",
        "textMode": "value",
        "colorMode": "value"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 0.2 },
              { "color": "red", "value": 1 }
            ]
          }
        },
        "overrides": []
      }
    },
    {
      "type": "stat",
      "title": "Latency p95 (s)",
      "gridPos": { "x": 12, "y": 0, "w": 6, "h": 5 },
      "datasource": "$datasource",
      "targets": [
        {
          "refId": "A",
          "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_highr_seconds_bucket[5m])) by (le))"
        }
      ],
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "horizontal",
        "textMode": "value",
        "colorMode": "value"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "decimals": 3
        },
        "overrides": []
      }
    },
    {
      "type": "timeseries",
      "title": "Requests by status (RPS)",
      "gridPos": { "x": 0, "y": 5, "w": 18, "h": 8 },
      "datasource": "$datasource",
      "targets": [
        {
          "refId": "A",
          "expr": "sum by (status) (rate(http_requests_total{handler=~\"$handler\"}[1m]))",
          "legendFormat": "{{status}}"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "reqps" }, "overrides": [] },
      "options": { "legend": { "displayMode": "list", "placement": "right" } }
    },
    {
      "type": "timeseries",
      "title": "Latency p50/p95 (s)",
      "gridPos": { "x": 0, "y": 13, "w": 18, "h": 8 },
      "datasource": "$datasource",
      "targets": [
        {
          "refId": "A",
          "expr": "histogram_quantile(0.50, sum(rate(http_request_duration_highr_seconds_bucket[5m])) by (le))",
          "legendFormat": "p50"
        },
        {
          "refId": "B",
          "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_highr_seconds_bucket[5m])) by (le))",
          "legendFormat": "p95"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "s", "decimals": 3 }, "overrides": [] },
      "options": { "legend": { "displayMode": "list", "placement": "right" } }
    },
    {
      "type": "table",
      "title": "Top handlers (RPS)",
      "gridPos": { "x": 0, "y": 21, "w": 18, "h": 8 },
      "datasource": "$datasource",
      "targets": [
        {
          "refId": "A",
          "expr": "topk(15, sum by (handler) (rate(http_requests_total[1m])))",
          "format": "table"
        }
      ],
      "options": { "showHeader": true }
    }
  ]
}

